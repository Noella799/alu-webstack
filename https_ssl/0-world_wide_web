#!/usr/bin/env bash
# shellcheck disable=SC2086

domain="$1"
subdomain="$2"

get_record_info() {
    local d="$1"
    local s="$2"
    local fqdn="${s}.${d}"

    # Get the line right after "ANSWER SECTION:"
    local line
    line=$(dig "$fqdn" | grep -A1 'ANSWER SECTION:' | tail -n1)

    # Extract record type and destination using awk
    local record_type destination
    record_type=$(echo "$line" | awk '{print $4}')
    destination=$(echo "$line" | awk '{print $5}')

    echo "The subdomain $s is a $record_type record and points to $destination"
}

# Domain is mandatory (project says we don't need to handle edge cases)
if [ -z "$domain" ]; then
    exit 0
fi

if [ -n "$subdomain" ]; then
    # Domain + specific subdomain
    get_record_info "$domain" "$subdomain"
else
    # Only domain: check these in order
    for s in www lb-01 web-01 web-02; do
        get_record_info "$domain" "$s"
    done
fi

